# Lets store all our function at one place

# set your gmail and email
git config --global user.email "$gmail"
git config --global user.name "$github_username"

# lets store some variables
github_repo="https://$CIRRUS_REPO_OWNER:$github_token@github.com/$CIRRUS_REPO_FULL_NAME -b $CIRRUS_DEFAULT_BRANCH"
progress=https://cirrus-ci.com/build/$CIRRUS_BUILD_ID

# login in github before uploading
echo $github_token > mytoken.txt # login in github
gh auth login --with-token < mytoken.txt

# upload our rom zip
upload () {
upload_link=https://github.com/$github_username/$github_reponame
gh release create $rom_name --generate-notes --repo $upload_link
gh release upload --clobber $rom_name $1 --repo $upload_link
echo "Link: $repo_link/releases/download/$rom_name/$1"
}

# Compress function with pigz for faster compression
com () {
tar --use-compress-program="pigz -k -$2 " -cf $1.tar.gz $1
}

# install apt 
install_apt () {
curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | dd of=/usr/share/keyrings/githubcli-archive-keyring.gpg
chmod go+r /usr/share/keyrings/githubcli-archive-keyring.gpg
echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" | tee /etc/apt/sources.list.d/github-cli.list > /dev/null
apt update && apt install wget pigz gh
}

# check Build Number
check_build_no () {
last_dir=${PWD}
cd /tmp/ci
git show -s --format=%s | awk 'NF>1{print $NF}' > /tmp/last_digit.txt # store last digit which is our build number from commit name
last_value="`cat /tmp/last_digit.txt`" # store build number
case "$last_value" in
		 1|2|3|4|5|6|7|8|9)
		 build_no=$last_value
		 ;;
		 *) # at first build we haven't stored any digit in commit name
		 build_no=0 # so lets use 0 as it is going to become 1 while committing
esac
new_build_no=$(($build_no + 1))
cd $last_dir
rm -rf /tmp/last_* # clean up xD
}

# push to telegram
tg () {
curl -s "https://api.telegram.org/bot${bot_api}/sendmessage" --data "text=$1&chat_id=${chat_id}"
}
